<!DOCTYPE html>import React, { useState, useEffect } from 'react';
import { Plus, Download, TrendingUp, User, Calendar, Activity, Pill, FileText, AlertCircle, Settings, Edit2, Save, X, Share2, Link, Check, RefreshCw, AlertTriangle, CheckCircle, Globe } from 'lucide-react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ReferenceLine } from 'recharts';

// Translations
const TRANSLATIONS = {
  en: {
    appTitle: "Parent Health Tracker",
    appSubtitle: "Comprehensive lab results and health monitoring",
    dashboard: "Dashboard",
    labResults: "Lab Results",
    medications: "Medications",
    appointments: "Appointments",
    notes: "Notes",
    mom: "Mom",
    dad: "Dad",
    addNew: "Add New",
    export: "Export",
    customize: "Customize",
    enableSharing: "Enable Sharing",
    sharingEnabled: "Sharing Enabled",
    totalLabTests: "Total Lab Tests",
    activeMedications: "Active Medications",
    upcomingAppointments: "Upcoming Appointments",
    abnormalValues: "Abnormal Values",
    allNormal: "All normal",
    needsAttention: "Needs attention",
    last: "Last",
    currentlyTaking: "Currently taking",
    next: "Next",
    kidneyFunctionStatus: "Kidney Function Status",
    healthScore: "Health Score",
    areasOfConcern: "Areas of Concern",
    valuesOutOfRange: "Values Out of Range",
    normal: "Normal",
    low: "Low",
    high: "High",
    belowRange: "Below Range",
    aboveRange: "Above Range",
    normalRange: "Normal Range",
    latestValue: "Latest Value",
    customRange: "Custom range",
    customRangeActive: "Custom range active",
    viewTrend: "View trend",
    close: "Close",
    save: "Save",
    cancel: "Cancel",
    date: "Date",
    testType: "Test Type",
    enterResults: "Enter Results",
    value: "Value",
    addLabResults: "Add Lab Results",
    addMedication: "Add Medication",
    addAppointment: "Add Appointment",
    addNote: "Add Note",
    medicationName: "Medication Name",
    dosage: "Dosage",
    frequency: "Frequency",
    time: "Time",
    oncDaily: "Once daily",
    twiceDaily: "Twice daily",
    threeTimesDaily: "Three times daily",
    asNeeded: "As needed",
    weekly: "Weekly",
    doctor: "Doctor",
    appointmentType: "Appointment Type",
    title: "Title",
    category: "Category",
    content: "Content",
    general: "General",
    symptoms: "Symptoms",
    diet: "Diet",
    exercise: "Exercise",
    concerns: "Concerns",
    noLabResults: "No lab results yet",
    noMedications: "No medications added yet",
    noAppointments: "No appointments scheduled",
    noNotes: "No notes added yet",
    changeUnits: "Change Units of Measurement",
    unitPreferences: "Unit Preferences",
    customizeReferenceRanges: "Customize Reference Ranges",
    customReferenceRanges: "Custom Reference Ranges",
    resetToDefault: "Reset to Default",
    minimum: "Minimum",
    maximum: "Maximum",
    resetAllDefaults: "Reset All to Defaults",
    addPanel: "Add Panel",
    deletePanel: "Delete",
    language: "Language"
  },
  th: {
    appTitle: "‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà",
    appSubtitle: "‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡πÅ‡∏•‡∏õ‡πÅ‡∏•‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô",
    dashboard: "‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î",
    labResults: "‡∏ú‡∏•‡πÅ‡∏•‡∏õ",
    medications: "‡∏¢‡∏≤",
    appointments: "‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢",
    notes: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å",
    mom: "‡πÅ‡∏°‡πà",
    dad: "‡∏û‡πà‡∏≠",
    addNew: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà",
    export: "‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å",
    customize: "‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á",
    enableSharing: "‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå",
    sharingEnabled: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏ä‡∏£‡πå",
    totalLabTests: "‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏•‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
    activeMedications: "‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡∏π‡πà",
    upcomingAppointments: "‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏∂‡∏á",
    abnormalValues: "‡∏Ñ‡πà‡∏≤‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥",
    allNormal: "‡∏õ‡∏Å‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
    needsAttention: "‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡πÅ‡∏•",
    last: "‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î",
    currentlyTaking: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ",
    next: "‡∏ñ‡∏±‡∏î‡πÑ‡∏õ",
    kidneyFunctionStatus: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÑ‡∏ï",
    healthScore: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û",
    areasOfConcern: "‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á",
    valuesOutOfRange: "‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á",
    normal: "‡∏õ‡∏Å‡∏ï‡∏¥",
    low: "‡∏ï‡πà‡∏≥",
    high: "‡∏™‡∏π‡∏á",
    belowRange: "‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥",
    aboveRange: "‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥",
    normalRange: "‡∏ä‡πà‡∏ß‡∏á‡∏õ‡∏Å‡∏ï‡∏¥",
    latestValue: "‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î",
    customRange: "‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á",
    customRangeActive: "‡πÉ‡∏ä‡πâ‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á",
    viewTrend: "‡∏î‡∏π‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°",
    close: "‡∏õ‡∏¥‡∏î",
    save: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å",
    cancel: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
    date: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà",
    testType: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à",
    enterResults: "‡πÉ‡∏™‡πà‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à",
    value: "‡∏Ñ‡πà‡∏≤",
    addLabResults: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏•‡πÅ‡∏•‡∏õ",
    addMedication: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤",
    addAppointment: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢",
    addNote: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å",
    medicationName: "‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤",
    dosage: "‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤",
    frequency: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà",
    time: "‡πÄ‡∏ß‡∏•‡∏≤",
    onceDaily: "‡∏ß‡∏±‡∏ô‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
    twiceDaily: "‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
    threeTimesDaily: "‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
    asNeeded: "‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£",
    weekly: "‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
    doctor: "‡πÅ‡∏û‡∏ó‡∏¢‡πå",
    appointmentType: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢",
    title: "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠",
    category: "‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà",
    content: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤",
    general: "‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ",
    symptoms: "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£",
    diet: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£",
    exercise: "‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢",
    concerns: "‡∏Ç‡πâ‡∏≠‡∏Å‡∏±‡∏á‡∏ß‡∏•",
    noLabResults: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡πÅ‡∏•‡∏õ",
    noMedications: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°",
    noAppointments: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢",
    noNotes: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å",
    changeUnits: "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î",
    unitPreferences: "‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πà‡∏ß‡∏¢",
    customizeReferenceRanges: "‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á",
    customReferenceRanges: "‡∏ä‡πà‡∏ß‡∏á‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á",
    resetToDefault: "‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô",
    minimum: "‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î",
    maximum: "‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î",
    resetAllDefaults: "‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
    addPanel: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ú‡∏á",
    deletePanel: "‡∏•‡∏ö",
    language: "‡∏†‡∏≤‡∏©‡∏≤"
  }
};

// Unit conversion mappings
const UNIT_CONVERSIONS = {
  'Glucose': {
    'mg/dL': { to: { 'mmol/L': (v) => v / 18 }, default: true },
    'mmol/L': { to: { 'mg/dL': (v) => v * 18 } }
  },
  'Total Cholesterol': {
    'mg/dL': { to: { 'mmol/L': (v) => v / 38.67 }, default: true },
    'mmol/L': { to: { 'mg/dL': (v) => v * 38.67 } }
  },
  'LDL Cholesterol': {
    'mg/dL': { to: { 'mmol/L': (v) => v / 38.67 }, default: true },
    'mmol/L': { to: { 'mg/dL': (v) => v * 38.67 } }
  },
  'HDL Cholesterol': {
    'mg/dL': { to: { 'mmol/L': (v) => v / 38.67 }, default: true },
    'mmol/L': { to: { 'mg/dL': (v) => v * 38.67 } }
  },
  'Triglycerides': {
    'mg/dL': { to: { 'mmol/L': (v) => v / 88.57 }, default: true },
    'mmol/L': { to: { 'mg/dL': (v) => v * 88.57 } }
  },
  'Creatinine': {
    'mg/dL': { to: { 'Œºmol/L': (v) => v * 88.4 }, default: true },
    'Œºmol/L': { to: { 'mg/dL': (v) => v / 88.4 } }
  },
  'BUN': {
    'mg/dL': { to: { 'mmol/L': (v) => v / 2.8 }, default: true },
    'mmol/L': { to: { 'mg/dL': (v) => v * 2.8 } }
  },
  'Fasting Glucose': {
    'mg/dL': { to: { 'mmol/L': (v) => v / 18 }, default: true },
    'mmol/L': { to: { 'mg/dL': (v) => v * 18 } }
  },
  'Hemoglobin': {
    'g/dL': { to: { 'g/L': (v) => v * 10, 'mmol/L': (v) => v * 0.6206 }, default: true },
    'g/L': { to: { 'g/dL': (v) => v / 10, 'mmol/L': (v) => v * 0.06206 } },
    'mmol/L': { to: { 'g/dL': (v) => v / 0.6206, 'g/L': (v) => v / 0.06206 } }
  },
  'Calcium': {
    'mg/dL': { to: { 'mmol/L': (v) => v / 4.0 }, default: true },
    'mmol/L': { to: { 'mg/dL': (v) => v * 4.0 } }
  },
  'Uric Acid': {
    'mg/dL': { to: { '¬µmol/L': (v) => v * 59.48 }, default: true },
    '¬µmol/L': { to: { 'mg/dL': (v) => v / 59.48 } }
  },
  'Cystatin C': {
    'mg/L': { to: { 'nmol/L': (v) => v * 74.9 }, default: true },
    'nmol/L': { to: { 'mg/L': (v) => v / 74.9 } }
  }
};

const DEFAULT_LAB_TEMPLATES = {
  'Complete Blood Count (CBC)': [
    { name: 'WBC', unit: 'K/uL', refMin: 4.5, refMax: 11.0 },
    { name: 'RBC', unit: 'M/uL', refMin: 4.5, refMax: 5.9 },
    { name: 'Hemoglobin', unit: 'g/dL', refMin: 13.5, refMax: 17.5 },
    { name: 'Hematocrit', unit: '%', refMin: 38.8, refMax: 50.0 },
    { name: 'Platelets', unit: 'K/uL', refMin: 150, refMax: 400 },
    { name: 'MCV', unit: 'fL', refMin: 80, refMax: 100 },
    { name: 'MCH', unit: 'pg', refMin: 27, refMax: 33 },
    { name: 'MCHC', unit: 'g/dL', refMin: 32, refMax: 36 }
  ],
  'Metabolic Panel (CMP)': [
    { name: 'Glucose', unit: 'mg/dL', refMin: 70, refMax: 100 },
    { name: 'BUN', unit: 'mg/dL', refMin: 7, refMax: 20 },
    { name: 'Creatinine', unit: 'mg/dL', refMin: 0.7, refMax: 1.3 },
    { name: 'eGFR', unit: 'mL/min/1.73m¬≤', refMin: 60, refMax: 120 },
    { name: 'Sodium', unit: 'mmol/L', refMin: 136, refMax: 145 },
    { name: 'Potassium', unit: 'mmol/L', refMin: 3.5, refMax: 5.0 },
    { name: 'Chloride', unit: 'mmol/L', refMin: 98, refMax: 107 },
    { name: 'CO2', unit: 'mmol/L', refMin: 23, refMax: 29 },
    { name: 'Calcium', unit: 'mg/dL', refMin: 8.5, refMax: 10.5 }
  ],
  'Liver Function': [
    { name: 'ALT', unit: 'U/L', refMin: 7, refMax: 56 },
    { name: 'AST', unit: 'U/L', refMin: 10, refMax: 40 },
    { name: 'ALP', unit: 'U/L', refMin: 44, refMax: 147 },
    { name: 'Bilirubin Total', unit: 'mg/dL', refMin: 0.3, refMax: 1.2 },
    { name: 'Bilirubin Direct', unit: 'mg/dL', refMin: 0.0, refMax: 0.3 },
    { name: 'Albumin', unit: 'g/dL', refMin: 3.5, refMax: 5.5 },
    { name: 'Total Protein', unit: 'g/dL', refMin: 6.0, refMax: 8.3 },
    { name: 'GGT', unit: 'U/L', refMin: 0, refMax: 51 }
  ],
  'Lipid Panel': [
    { name: 'Total Cholesterol', unit: 'mg/dL', refMin: 0, refMax: 200 },
    { name: 'LDL Cholesterol', unit: 'mg/dL', refMin: 0, refMax: 100 },
    { name: 'HDL Cholesterol', unit: 'mg/dL', refMin: 40, refMax: 999 },
    { name: 'Triglycerides', unit: 'mg/dL', refMin: 0, refMax: 150 },
    { name: 'VLDL', unit: 'mg/dL', refMin: 5, refMax: 40 }
  ],
  'Thyroid Function': [
    { name: 'TSH', unit: 'mIU/L', refMin: 0.4, refMax: 4.0 },
    { name: 'Free T4', unit: 'ng/dL', refMin: 0.8, refMax: 1.8 },
    { name: 'Free T3', unit: 'pg/mL', refMin: 2.3, refMax: 4.2 },
    { name: 'TPO Antibody', unit: 'IU/mL', refMin: 0, refMax: 34 }
  ],
  'Diabetes Markers': [
    { name: 'HbA1c', unit: '%', refMin: 0, refMax: 5.6 },
    { name: 'Fasting Glucose', unit: 'mg/dL', refMin: 70, refMax: 100 },
    { name: 'Insulin', unit: '¬µU/mL', refMin: 2.6, refMax: 24.9 }
  ],
  'Vitamins & Minerals': [
    { name: 'Vitamin D', unit: 'ng/mL', refMin: 30, refMax: 100 },
    { name: 'Vitamin B12', unit: 'pg/mL', refMin: 200, refMax: 900 },
    { name: 'Folate', unit: 'ng/mL', refMin: 3.0, refMax: 20.0 },
    { name: 'Iron', unit: '¬µg/dL', refMin: 60, refMax: 170 },
    { name: 'Ferritin', unit: 'ng/mL', refMin: 30, refMax: 400 },
    { name: 'Magnesium', unit: 'mg/dL', refMin: 1.7, refMax: 2.2 }
  ],
  'Cardiac Markers': [
    { name: 'Troponin I', unit: 'ng/mL', refMin: 0, refMax: 0.04 },
    { name: 'CK-MB', unit: 'ng/mL', refMin: 0, refMax: 5.0 },
    { name: 'BNP', unit: 'pg/mL', refMin: 0, refMax: 100 },
    { name: 'CRP', unit: 'mg/L', refMin: 0, refMax: 3.0 }
  ],
  'Tumor Markers': [
    { name: 'PSA', unit: 'ng/mL', refMin: 0, refMax: 4.0 },
    { name: 'CEA', unit: 'ng/mL', refMin: 0, refMax: 3.0 },
    { name: 'CA 19-9', unit: 'U/mL', refMin: 0, refMax: 37 },
    { name: 'CA 125', unit: 'U/mL', refMin: 0, refMax: 35 },
    { name: 'AFP', unit: 'ng/mL', refMin: 0, refMax: 9.0 }
  ],
  'Coagulation': [
    { name: 'PT', unit: 'seconds', refMin: 11, refMax: 13.5 },
    { name: 'INR', unit: 'ratio', refMin: 0.8, refMax: 1.1 },
    { name: 'aPTT', unit: 'seconds', refMin: 25, refMax: 35 },
    { name: 'D-Dimer', unit: 'ng/mL', refMin: 0, refMax: 500 }
  ],
  'Electrolytes Extended': [
    { name: 'Phosphorus', unit: 'mg/dL', refMin: 2.5, refMax: 4.5 },
    { name: 'Uric Acid', unit: 'mg/dL', refMin: 3.5, refMax: 7.2 },
    { name: 'Lactate', unit: 'mmol/L', refMin: 0.5, refMax: 2.0 }
  ],
  'Hormones': [
    { name: 'Cortisol', unit: '¬µg/dL', refMin: 6.0, refMax: 23.0 },
    { name: 'Testosterone', unit: 'ng/dL', refMin: 300, refMax: 1000 },
    { name: 'Estradiol', unit: 'pg/mL', refMin: 10, refMax: 50 },
    { name: 'Prolactin', unit: 'ng/mL', refMin: 4.0, refMax: 15.0 }
  ],
  'Kidney Function Panel': [
    { name: 'Creatinine', unit: 'mg/dL', refMin: 0.7, refMax: 1.3 },
    { name: 'BUN', unit: 'mg/dL', refMin: 7, refMax: 20 },
    { name: 'eGFR', unit: 'mL/min/1.73m¬≤', refMin: 60, refMax: 120 },
    { name: 'BUN/Creatinine Ratio', unit: 'ratio', refMin: 10, refMax: 20 },
    { name: 'Albumin', unit: 'g/dL', refMin: 3.5, refMax: 5.5 },
    { name: 'Uric Acid', unit: 'mg/dL', refMin: 3.5, refMax: 7.2 },
    { name: 'Cystatin C', unit: 'mg/L', refMin: 0.5, refMax: 1.0 },
    { name: 'Albumin/Creatinine Ratio', unit: 'mg/g', refMin: 0, refMax: 30 },
    { name: 'Protein (Urine)', unit: 'mg/dL', refMin: 0, refMax: 14 },
    { name: 'Microalbumin (Urine)', unit: 'mg/L', refMin: 0, refMax: 30 }
  ]
};

const LabTracker = () => {
  const [selectedParent, setSelectedParent] = useState('mom');
  const [activeTab, setActiveTab] = useState('dashboard');
  const [labResults, setLabResults] = useState({ mom: [], dad: [] });
  const [medications, setMedications] = useState({ mom: [], dad: [] });
  const [appointments, setAppointments] = useState({ mom: [], dad: [] });
  const [notes, setNotes] = useState({ mom: [], dad: [] });
  const [labTemplates, setLabTemplates] = useState(DEFAULT_LAB_TEMPLATES);
  const [showForm, setShowForm] = useState(false);
  const [showChart, setShowChart] = useState(null);
  const [showSettings, setShowSettings] = useState(false);
  const [sharingEnabled, setSharingEnabled] = useState(false);
  const [showShareDialog, setShowShareDialog] = useState(false);
  const [linkCopied, setLinkCopied] = useState(false);
  const [isLoading, setIsLoading] = useState(true);
  const [unitPreferences, setUnitPreferences] = useState({});
  const [customRanges, setCustomRanges] = useState({ mom: {}, dad: {} });
  const [language, setLanguage] = useState('en');

  // Load data on mount
  useEffect(() => {
    loadData();
  }, []);

  // Save data whenever it changes
  useEffect(() => {
    if (!isLoading) {
      saveData();
    }
  }, [labResults, medications, appointments, notes, labTemplates, sharingEnabled, unitPreferences, customRanges, language]);

  // Translation helper
  const t = (key) => TRANSLATIONS[language][key] || key;

  // Convert value between units
  const convertValue = (testName, value, fromUnit, toUnit) => {
    if (!UNIT_CONVERSIONS[testName] || fromUnit === toUnit) {
      return value;
    }
    
    const conversion = UNIT_CONVERSIONS[testName][fromUnit];
    if (conversion && conversion.to[toUnit]) {
      return parseFloat(conversion.to[toUnit](value).toFixed(2));
    }
    return value;
  };

  // Get available units for a test
  const getAvailableUnits = (testName) => {
    if (!UNIT_CONVERSIONS[testName]) return null;
    return Object.keys(UNIT_CONVERSIONS[testName]);
  };

  // Get current unit preference or default
  const getCurrentUnit = (testName, originalUnit) => {
    if (unitPreferences[testName]) {
      return unitPreferences[testName];
    }
    // Check if there's a default unit defined
    if (UNIT_CONVERSIONS[testName]) {
      const defaultUnit = Object.keys(UNIT_CONVERSIONS[testName]).find(
        unit => UNIT_CONVERSIONS[testName][unit].default
      );
      return defaultUnit || originalUnit;
    }
    return originalUnit;
  };

  // Convert result to preferred unit and apply custom ranges
  const convertResult = (result) => {
    const preferredUnit = getCurrentUnit(result.name, result.unit);
    let convertedValue = result.value;
    let convertedMin = result.refMin;
    let convertedMax = result.refMax;
    
    if (preferredUnit !== result.unit) {
      convertedValue = convertValue(result.name, result.value, result.unit, preferredUnit);
      convertedMin = convertValue(result.name, result.refMin, result.unit, preferredUnit);
      convertedMax = convertValue(result.name, result.refMax, result.unit, preferredUnit);
    }
    
    // Apply custom ranges if they exist for this test and unit (parent-specific)
    const rangeKey = `${result.name}-${preferredUnit}`;
    const parentRanges = customRanges[selectedParent] || {};
    if (parentRanges[rangeKey]) {
      convertedMin = parentRanges[rangeKey].min;
      convertedMax = parentRanges[rangeKey].max;
    }
    
    return {
      ...result,
      value: convertedValue,
      unit: preferredUnit,
      refMin: convertedMin,
      refMax: convertedMax,
      originalUnit: result.unit,
      originalValue: result.value,
      hasCustomRange: !!parentRanges[rangeKey]
    };
  };

  const loadData = async () => {
    try {
      // First check for sharing mode
      const sharingResult = await window.storage.get('sharing-enabled', true);
      const isShared = sharingResult?.value === 'true';
      setSharingEnabled(isShared);

      // Load all data
      const labsResult = await window.storage.get('lab-results', isShared);
      const medsResult = await window.storage.get('medications', isShared);
      const aptsResult = await window.storage.get('appointments', isShared);
      const notesResult = await window.storage.get('notes', isShared);
      const templatesResult = await window.storage.get('lab-templates', isShared);
      const unitsResult = await window.storage.get('unit-preferences', isShared);
      const rangesResult = await window.storage.get('custom-ranges', isShared);
      const languageResult = await window.storage.get('language', isShared);

      if (labsResult?.value) setLabResults(JSON.parse(labsResult.value));
      if (medsResult?.value) setMedications(JSON.parse(medsResult.value));
      if (aptsResult?.value) setAppointments(JSON.parse(aptsResult.value));
      if (notesResult?.value) setNotes(JSON.parse(notesResult.value));
      if (unitsResult?.value) setUnitPreferences(JSON.parse(unitsResult.value));
      if (languageResult?.value) setLanguage(languageResult.value);
      
      // Handle custom ranges - migrate old format to new parent-specific format
      if (rangesResult?.value) {
        const savedRanges = JSON.parse(rangesResult.value);
        // Check if it's the old format (flat object) or new format (nested by parent)
        if (savedRanges.mom || savedRanges.dad) {
          setCustomRanges(savedRanges);
        } else {
          // Old format - apply to both parents
          setCustomRanges({ mom: savedRanges, dad: savedRanges });
        }
      }
      
      // Merge saved templates with new default templates
      if (templatesResult?.value) {
        const savedTemplates = JSON.parse(templatesResult.value);
        const mergedTemplates = { ...DEFAULT_LAB_TEMPLATES, ...savedTemplates };
        setLabTemplates(mergedTemplates);
      } else {
        setLabTemplates(DEFAULT_LAB_TEMPLATES);
      }
      
    } catch (error) {
      console.log('No existing data found, starting fresh');
    } finally {
      setIsLoading(false);
    }
  };

  const saveData = async () => {
    try {
      await window.storage.set('lab-results', JSON.stringify(labResults), sharingEnabled);
      await window.storage.set('medications', JSON.stringify(medications), sharingEnabled);
      await window.storage.set('appointments', JSON.stringify(appointments), sharingEnabled);
      await window.storage.set('notes', JSON.stringify(notes), sharingEnabled);
      await window.storage.set('lab-templates', JSON.stringify(labTemplates), sharingEnabled);
      await window.storage.set('unit-preferences', JSON.stringify(unitPreferences), sharingEnabled);
      await window.storage.set('custom-ranges', JSON.stringify(customRanges), sharingEnabled);
      await window.storage.set('language', language, sharingEnabled);
      await window.storage.set('sharing-enabled', String(sharingEnabled), true);
    } catch (error) {
      console.error('Error saving data:', error);
    }
  };

  const toggleSharing = async () => {
    const newSharingState = !sharingEnabled;
    
    if (newSharingState) {
      // Enabling sharing - migrate data to shared storage
      try {
        await window.storage.set('lab-results', JSON.stringify(labResults), true);
        await window.storage.set('medications', JSON.stringify(medications), true);
        await window.storage.set('appointments', JSON.stringify(appointments), true);
        await window.storage.set('notes', JSON.stringify(notes), true);
        await window.storage.set('lab-templates', JSON.stringify(labTemplates), true);
        await window.storage.set('unit-preferences', JSON.stringify(unitPreferences), true);
        await window.storage.set('custom-ranges', JSON.stringify(customRanges), true);
        await window.storage.set('language', language, true);
        await window.storage.set('sharing-enabled', 'true', true);
        setSharingEnabled(true);
        setShowShareDialog(true);
      } catch (error) {
        console.error('Error enabling sharing:', error);
        alert('Error enabling sharing. Please try again.');
      }
    } else {
      // Disabling sharing - migrate data to private storage
      if (confirm('This will make the data private again. Your caregiver will lose access. Continue?')) {
        try {
          await window.storage.set('lab-results', JSON.stringify(labResults), false);
          await window.storage.set('medications', JSON.stringify(medications), false);
          await window.storage.set('appointments', JSON.stringify(appointments), false);
          await window.storage.set('notes', JSON.stringify(notes), false);
          await window.storage.set('lab-templates', JSON.stringify(labTemplates), false);
          await window.storage.set('unit-preferences', JSON.stringify(unitPreferences), false);
          await window.storage.set('custom-ranges', JSON.stringify(customRanges), false);
          await window.storage.set('language', language, false);
          await window.storage.set('sharing-enabled', 'false', true);
          setSharingEnabled(false);
        } catch (error) {
          console.error('Error disabling sharing:', error);
          alert('Error disabling sharing. Please try again.');
        }
      }
    }
  };

  const copyShareLink = () => {
    const shareLink = window.location.href;
    navigator.clipboard.writeText(shareLink);
    setLinkCopied(true);
    setTimeout(() => setLinkCopied(false), 3000);
  };

  const ShareDialog = () => (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg p-6 max-w-md w-full mx-4">
        <div className="flex justify-between items-center mb-4">
          <h3 className="text-xl font-semibold">Share Dashboard</h3>
          <button onClick={() => setShowShareDialog(false)} className="text-gray-500 hover:text-gray-700">
            <X size={24} />
          </button>
        </div>
        
        <div className="space-y-4">
          <div className="bg-green-50 border border-green-200 rounded p-4">
            <div className="flex items-start gap-2">
              <Check className="text-green-600 mt-1" size={20} />
              <div>
                <p className="font-medium text-green-800">Sharing is now enabled!</p>
                <p className="text-sm text-green-700 mt-1">
                  Anyone with this link can view and edit the health data.
                </p>
              </div>
            </div>
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Share this link with your caregiver:</label>
            <div className="flex gap-2">
              <input
                type="text"
                value={window.location.href}
                readOnly
                className="flex-1 p-2 border rounded bg-gray-50 text-sm"
              />
              <button
                onClick={copyShareLink}
                className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center gap-2"
              >
                {linkCopied ? <Check size={16} /> : <Link size={16} />}
                {linkCopied ? 'Copied!' : 'Copy'}
              </button>
            </div>
          </div>

          <div className="bg-blue-50 border border-blue-200 rounded p-4">
            <p className="text-sm text-blue-800">
              <strong>How it works:</strong>
            </p>
            <ul className="text-sm text-blue-700 mt-2 space-y-1 list-disc list-inside">
              <li>Copy the link above</li>
              <li>Send it to your caregiver via email, WhatsApp, or text</li>
              <li>They open the link in their browser</li>
              <li>Both of you can view and update the data in real-time</li>
            </ul>
          </div>

          <div className="bg-yellow-50 border border-yellow-200 rounded p-4">
            <p className="text-sm text-yellow-800">
              <strong>‚ö†Ô∏è Important:</strong> Anyone with this link can access and modify the health data. Only share with trusted caregivers.
            </p>
          </div>

          <button
            onClick={() => setShowShareDialog(false)}
            className="w-full bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700"
          >
            Got it
          </button>
        </div>
      </div>
    </div>
  );

  const addLabResult = (labData) => {
    const newLab = { ...labData, id: Date.now() };
    setLabResults({
      ...labResults,
      [selectedParent]: [...labResults[selectedParent], newLab]
    });
  };

  const addMedication = (med) => {
    const newMed = { ...med, id: Date.now() };
    setMedications({
      ...medications,
      [selectedParent]: [...medications[selectedParent], newMed]
    });
  };

  const addAppointment = (apt) => {
    const newApt = { ...apt, id: Date.now() };
    setAppointments({
      ...appointments,
      [selectedParent]: [...appointments[selectedParent], newApt]
    });
  };

  const addNote = (note) => {
    const newNote = { ...note, id: Date.now(), timestamp: new Date().toISOString() };
    setNotes({
      ...notes,
      [selectedParent]: [...notes[selectedParent], newNote]
    });
  };

  const deleteItem = (id, type) => {
    switch(type) {
      case 'labs':
        setLabResults({
          ...labResults,
          [selectedParent]: labResults[selectedParent].filter(l => l.id !== id)
        });
        break;
      case 'medications':
        setMedications({
          ...medications,
          [selectedParent]: medications[selectedParent].filter(m => m.id !== id)
        });
        break;
      case 'appointments':
        setAppointments({
          ...appointments,
          [selectedParent]: appointments[selectedParent].filter(a => a.id !== id)
        });
        break;
      case 'notes':
        setNotes({
          ...notes,
          [selectedParent]: notes[selectedParent].filter(n => n.id !== id)
        });
        break;
    }
  };

  const exportToCSV = () => {
    const parent = selectedParent === 'mom' ? 'Mom' : 'Dad';
    let csv = `${parent}'s Health Data Export\nGenerated: ${new Date().toLocaleString()}\n\n`;
    
    csv += 'LAB RESULTS WITH REFERENCE RANGES\n';
    csv += 'Date,Test Type,Test Name,Value,Unit,Reference Min,Reference Max,Status,Flag\n';
    labResults[selectedParent].forEach(lab => {
      lab.results.forEach(result => {
        const converted = convertResult(result);
        let status = 'Normal';
        let flag = '';
        if (converted.value < converted.refMin) {
          status = 'Low';
          flag = '‚ö† BELOW RANGE';
        } else if (converted.value > converted.refMax) {
          status = 'High';
          flag = '‚ö† ABOVE RANGE';
        }
        csv += `${lab.date},${lab.testType},${converted.name},${converted.value},${converted.unit},${converted.refMin},${converted.refMax},${status},${flag}\n`;
      });
    });
    
    // Add kidney function summary
    const kidneyTests = ['Creatinine', 'BUN', 'eGFR', 'BUN/Creatinine Ratio', 'Albumin/Creatinine Ratio', 'Uric Acid', 'Cystatin C'];
    const kidneyData = [];
    kidneyTests.forEach(testName => {
      let latest = null;
      let latestDate = null;
      labResults[selectedParent].forEach(lab => {
        lab.results.forEach(result => {
          if (result.name === testName) {
            const labDate = new Date(lab.date);
            if (!latestDate || labDate > latestDate) {
              latestDate = labDate;
              latest = { ...convertResult(result), date: lab.date };
            }
          }
        });
      });
      if (latest) kidneyData.push(latest);
    });
    
    if (kidneyData.length > 0) {
      csv += '\nKIDNEY FUNCTION SUMMARY (Latest Results)\n';
      csv += 'Test Name,Value,Unit,Reference Min,Reference Max,Status,Date\n';
      kidneyData.forEach(test => {
        const status = test.value < test.refMin ? 'Low' : test.value > test.refMax ? 'High' : 'Normal';
        csv += `${test.name},${test.value},${test.unit},${test.refMin},${test.refMax},${status},${test.date}\n`;
      });
    }
    
    csv += '\nMEDICATIONS\n';
    csv += 'Name,Dosage,Frequency,Time\n';
    medications[selectedParent].forEach(med => {
      csv += `${med.name},${med.dosage},${med.frequency},${med.time}\n`;
    });
    
    csv += '\nAPPOINTMENTS\n';
    csv += 'Date,Doctor,Type,Notes\n';
    appointments[selectedParent].forEach(apt => {
      csv += `${apt.date},${apt.doctor},${apt.type},"${apt.notes || ''}"\n`;
    });
    
    csv += '\nNOTES\n';
    csv += 'Date,Title,Category,Content\n';
    notes[selectedParent].forEach(note => {
      csv += `${new Date(note.timestamp).toLocaleString()},"${note.title}",${note.category},"${note.content}"\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${parent}_Health_Data_${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
  };

  const SettingsPanel = () => {
    const [editingPanel, setEditingPanel] = useState(null);
    const [tempTemplates, setTempTemplates] = useState(labTemplates);
    const [newPanelName, setNewPanelName] = useState('');
    const [newTest, setNewTest] = useState({ name: '', unit: '', refMin: '', refMax: '' });
    const [showUnitSettings, setShowUnitSettings] = useState(false);
    const [showRangeSettings, setShowRangeSettings] = useState(false);

    // Get all tests that have unit conversions available
    const testsWithConversions = Object.keys(UNIT_CONVERSIONS);
    
    // Get all unique tests from lab results for range customization (parent-specific)
    const allTests = new Set();
    labResults[selectedParent].forEach(lab => {
      lab.results.forEach(r => {
        const unit = getCurrentUnit(r.name, r.unit);
        allTests.add(`${r.name}-${unit}`);
      });
    });
    const testsForRangeCustomization = Array.from(allTests).sort();
    
    const parentRanges = customRanges[selectedParent] || {};

    const handleSavePanel = (panelName) => {
      setLabTemplates(tempTemplates);
      setEditingPanel(null);
    };

    const handleUpdateTest = (panelName, testIndex, field, value) => {
      const updated = { ...tempTemplates };
      updated[panelName][testIndex][field] = field.includes('ref') ? parseFloat(value) : value;
      setTempTemplates(updated);
    };

    const handleAddTest = (panelName) => {
      if (newTest.name && newTest.unit) {
        const updated = { ...tempTemplates };
        updated[panelName].push({
          name: newTest.name,
          unit: newTest.unit,
          refMin: parseFloat(newTest.refMin) || 0,
          refMax: parseFloat(newTest.refMax) || 100
        });
        setTempTemplates(updated);
        setNewTest({ name: '', unit: '', refMin: '', refMax: '' });
      }
    };

    const handleRemoveTest = (panelName, testIndex) => {
      const updated = { ...tempTemplates };
      updated[panelName].splice(testIndex, 1);
      setTempTemplates(updated);
    };

    const handleAddPanel = () => {
      if (newPanelName && !tempTemplates[newPanelName]) {
        const updated = { ...tempTemplates };
        updated[newPanelName] = [];
        setTempTemplates(updated);
        setNewPanelName('');
        setEditingPanel(newPanelName);
      }
    };

    const handleDeletePanel = (panelName) => {
      if (confirm(`Delete "${panelName}" panel? This cannot be undone.`)) {
        const updated = { ...tempTemplates };
        delete updated[panelName];
        setTempTemplates(updated);
        setLabTemplates(updated);
      }
    };

    const handleResetToDefaults = () => {
      if (confirm('Reset all test panels to default values? This will remove any customizations.')) {
        setLabTemplates(DEFAULT_LAB_TEMPLATES);
        setTempTemplates(DEFAULT_LAB_TEMPLATES);
      }
    };

    return (
      <div className="bg-white p-6 rounded-lg shadow-md mb-4 max-h-[600px] overflow-y-auto">
        <div className="flex justify-between items-center mb-4">
          <h3 className="text-lg font-semibold">{t('customize')} Lab Test Panels</h3>
          <button onClick={() => setShowSettings(false)} className="text-gray-500 hover:text-gray-700">
            <X size={24} />
          </button>
        </div>

        {/* Language Selector */}
        <div className="mb-6 p-4 bg-purple-50 border border-purple-200 rounded-lg">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-2">
              <Globe size={20} className="text-purple-600" />
              <span className="font-semibold">{t('language')}</span>
            </div>
            <select
              value={language}
              onChange={(e) => setLanguage(e.target.value)}
              className="p-2 border rounded bg-white"
            >
              <option value="en">English</option>
              <option value="th">‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (Thai)</option>
            </select>
          </div>
        </div>

        <div className="mb-4 p-3 bg-blue-50 rounded border border-blue-200">
          <p className="text-sm text-blue-800">
            üìù Customize reference ranges for each test. Different labs may have different normal ranges.
          </p>
        </div>

        <div className="mb-6">
          <h4 className="font-medium mb-2">Add New Test Panel</h4>
          <div className="flex gap-2">
            <input
              type="text"
              placeholder="Panel name (e.g., 'Custom Panel')"
              value={newPanelName}
              onChange={(e) => setNewPanelName(e.target.value)}
              className="flex-1 p-2 border rounded"
            />
            <button
              onClick={handleAddPanel}
              className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
            >
              Add Panel
            </button>
          </div>
        </div>

        <div className="space-y-4">
          {Object.keys(tempTemplates).map(panelName => (
            <div key={panelName} className="border rounded-lg p-4">
              <div className="flex justify-between items-center mb-3">
                <h4 className="font-semibold text-lg">{panelName}</h4>
                <div className="flex gap-2">
                  {editingPanel === panelName ? (
                    <button
                      onClick={() => handleSavePanel(panelName)}
                      className="text-green-600 hover:text-green-800"
                    >
                      <Save size={20} />
                    </button>
                  ) : (
                    <button
                      onClick={() => { setEditingPanel(panelName); setTempTemplates(labTemplates); }}
                      className="text-blue-600 hover:text-blue-800"
                    >
                      <Edit2 size={20} />
                    </button>
                  )}
                  {!Object.keys(DEFAULT_LAB_TEMPLATES).includes(panelName) && (
                    <button
                      onClick={() => handleDeletePanel(panelName)}
                      className="text-red-600 hover:text-red-800"
                    >
                      <X size={20} />
                    </button>
                  )}
                </div>
              </div>

              {editingPanel === panelName ? (
                <div className="space-y-2">
                  {tempTemplates[panelName].map((test, idx) => (
                    <div key={idx} className="grid grid-cols-5 gap-2 items-center bg-gray-50 p-2 rounded">
                      <input
                        type="text"
                        value={test.name}
                        onChange={(e) => handleUpdateTest(panelName, idx, 'name', e.target.value)}
                        className="p-1 border rounded text-sm"
                        placeholder="Test name"
                      />
                      <input
                        type="text"
                        value={test.unit}
                        onChange={(e) => handleUpdateTest(panelName, idx, 'unit', e.target.value)}
                        className="p-1 border rounded text-sm"
                        placeholder="Unit"
                      />
                      <input
                        type="number"
                        step="0.01"
                        value={test.refMin}
                        onChange={(e) => handleUpdateTest(panelName, idx, 'refMin', e.target.value)}
                        className="p-1 border rounded text-sm"
                        placeholder="Min"
                      />
                      <input
                        type="number"
                        step="0.01"
                        value={test.refMax}
                        onChange={(e) => handleUpdateTest(panelName, idx, 'refMax', e.target.value)}
                        className="p-1 border rounded text-sm"
                        placeholder="Max"
                      />
                      <button
                        onClick={() => handleRemoveTest(panelName, idx)}
                        className="text-red-600 hover:text-red-800"
                      >
                        <X size={16} />
                      </button>
                    </div>
                  ))}
                  
                  <div className="grid grid-cols-5 gap-2 items-center mt-2">
                    <input
                      type="text"
                      value={newTest.name}
                      onChange={(e) => setNewTest({...newTest, name: e.target.value})}
                      className="p-1 border rounded text-sm"
                      placeholder="Test name"
                    />
                    <input
                      type="text"
                      value={newTest.unit}
                      onChange={(e) => setNewTest({...newTest, unit: e.target.value})}
                      className="p-1 border rounded text-sm"
                      placeholder="Unit"
                    />
                    <input
                      type="number"
                      step="0.01"
                      value={newTest.refMin}
                      onChange={(e) => setNewTest({...newTest, refMin: e.target.value})}
                      className="p-1 border rounded text-sm"
                      placeholder="Min"
                    />
                    <input
                      type="number"
                      step="0.01"
                      value={newTest.refMax}
                      onChange={(e) => setNewTest({...newTest, refMax: e.target.value})}
                      className="p-1 border rounded text-sm"
                      placeholder="Max"
                    />
                    <button
                      onClick={() => handleAddTest(panelName)}
                      className="bg-blue-600 text-white px-2 py-1 rounded text-sm hover:bg-blue-700"
                    >
                      Add
                    </button>
                  </div>
                </div>
              ) : (
                <div className="text-sm text-gray-600">
                  {tempTemplates[panelName].length} tests configured
                </div>
              )}
            </div>
          ))}
        </div>

        <div className="mt-6 pt-4 border-t">
          <button
            onClick={() => setShowUnitSettings(!showUnitSettings)}
            className="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 mb-4 flex items-center gap-2"
          >
            <RefreshCw size={20} />
            {showUnitSettings ? 'Hide Unit Settings' : 'Change Units of Measurement'}
          </button>

          {showUnitSettings && (
            <div className="bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-4">
              <h4 className="font-semibold mb-3">Unit Preferences</h4>
              <p className="text-sm text-gray-600 mb-4">
                Change how test results are displayed. Values will be automatically converted.
              </p>
              <div className="space-y-3">
                {testsWithConversions.map(testName => {
                  const availableUnits = getAvailableUnits(testName);
                  const currentUnit = unitPreferences[testName] || availableUnits[0];
                  
                  return (
                    <div key={testName} className="flex items-center justify-between bg-white p-3 rounded">
                      <span className="font-medium">{testName}</span>
                      <select
                        value={currentUnit}
                        onChange={(e) => setUnitPreferences({
                          ...unitPreferences,
                          [testName]: e.target.value
                        })}
                        className="p-2 border rounded"
                      >
                        {availableUnits.map(unit => (
                          <option key={unit} value={unit}>{unit}</option>
                        ))}
                      </select>
                    </div>
                  );
                })}
              </div>
            </div>
          )}

          <button
            onClick={() => setShowRangeSettings(!showRangeSettings)}
            className="bg-teal-600 text-white px-4 py-2 rounded hover:bg-teal-700 mb-4 flex items-center gap-2"
          >
            <Edit2 size={20} />
            {showRangeSettings ? 'Hide Reference Range Settings' : 'Customize Reference Ranges'}
          </button>

          {showRangeSettings && (
            <div className="bg-teal-50 border border-teal-200 rounded-lg p-4 mb-4">
              <h4 className="font-semibold mb-3">{t('customReferenceRanges')}</h4>
              <p className="text-sm text-gray-600 mb-2">
                Override default reference ranges for <strong>{selectedParent === 'mom' ? t('mom') : t('dad')}</strong>.
              </p>
              <p className="text-sm text-gray-600 mb-4">
                Each parent can have different reference ranges (e.g., different by age or gender).
              </p>
              {testsForRangeCustomization.length === 0 ? (
                <div className="text-center text-gray-500 py-4">
                  Add some lab results first to customize their reference ranges
                </div>
              ) : (
                <div className="space-y-3">
                  {testsForRangeCustomization.map(testKey => {
                    const [testName, unit] = testKey.split('-');
                    const customRange = parentRanges[testKey];
                    
                    // Find original range from lab results
                    let originalMin = '', originalMax = '';
                    labResults[selectedParent].forEach(lab => {
                      lab.results.forEach(r => {
                        if (r.name === testName) {
                          const converted = convertResult(r);
                          if (converted.unit === unit && !customRange) {
                            originalMin = converted.refMin;
                            originalMax = converted.refMax;
                          }
                        }
                      });
                    });
                    
                    return (
                      <div key={testKey} className="bg-white p-4 rounded border">
                        <div className="flex items-center justify-between mb-3">
                          <div>
                            <div className="font-medium text-gray-900">{testName}</div>
                            <div className="text-sm text-gray-600">Unit: {unit}</div>
                            {!customRange && originalMin && (
                              <div className="text-xs text-gray-500">
                                Default: {originalMin} - {originalMax}
                              </div>
                            )}
                          </div>
                          {customRange && (
                            <button
                              onClick={() => {
                                const updated = { ...customRanges };
                                delete updated[selectedParent][testKey];
                                setCustomRanges(updated);
                              }}
                              className="text-red-600 hover:text-red-800 text-sm"
                            >
                              {t('resetToDefault')}
                            </button>
                          )}
                        </div>
                        <div className="grid grid-cols-2 gap-3">
                          <div>
                            <label className="block text-xs font-medium mb-1 text-gray-700">
                              {t('minimum')}
                            </label>
                            <input
                              type="number"
                              step="0.01"
                              value={customRange?.min ?? originalMin}
                              onChange={(e) => {
                                const val = parseFloat(e.target.value);
                                if (!isNaN(val)) {
                                  setCustomRanges({
                                    ...customRanges,
                                    [selectedParent]: {
                                      ...parentRanges,
                                      [testKey]: {
                                        ...parentRanges[testKey],
                                        min: val,
                                        max: parentRanges[testKey]?.max ?? originalMax
                                      }
                                    }
                                  });
                                }
                              }}
                              className="w-full p-2 border rounded"
                              placeholder="Min value"
                            />
                          </div>
                          <div>
                            <label className="block text-xs font-medium mb-1 text-gray-700">
                              {t('maximum')}
                            </label>
                            <input
                              type="number"
                              step="0.01"
                              value={customRange?.max ?? originalMax}
                              onChange={(e) => {
                                const val = parseFloat(e.target.value);
                                if (!isNaN(val)) {
                                  setCustomRanges({
                                    ...customRanges,
                                    [selectedParent]: {
                                      ...parentRanges,
                                      [testKey]: {
                                        min: parentRanges[testKey]?.min ?? originalMin,
                                        max: val
                                      }
                                    }
                                  });
                                }
                              }}
                              className="w-full p-2 border rounded"
                              placeholder="Max value"
                            />
                          </div>
                        </div>
                        {customRange && (
                          <div className="mt-2 text-xs bg-teal-100 text-teal-800 px-2 py-1 rounded">
                            ‚úì Custom range active: {customRange.min} - {customRange.max} {unit}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          )}
        </div>

        <div className="mt-6 pt-4 border-t">
          <button
            onClick={handleResetToDefaults}
            className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"
          >
            Reset All to Defaults
          </button>
        </div>
      </div>
    );
  };

  const LabResultForm = () => {
    const [selectedTest, setSelectedTest] = useState(Object.keys(labTemplates)[0]);
    const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
    const [results, setResults] = useState({});

    useEffect(() => {
      const template = labTemplates[selectedTest];
      const initialResults = {};
      template.forEach(test => {
        initialResults[test.name] = { ...test, value: '' };
      });
      setResults(initialResults);
    }, [selectedTest]);

    const handleSubmit = () => {
      const resultsArray = Object.values(results).filter(r => r.value !== '');
      if (resultsArray.length > 0) {
        addLabResult({
          date,
          testType: selectedTest,
          results: resultsArray
        });
        setShowForm(false);
      }
    };

    return (
      <div className="bg-white p-6 rounded-lg shadow-md mb-4">
        <h3 className="text-lg font-semibold mb-4">Add Lab Results</h3>
        <div className="space-y-4">
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium mb-1">Date</label>
              <input
                type="date"
                value={date}
                onChange={(e) => setDate(e.target.value)}
                className="w-full p-2 border rounded"
              />
            </div>
            <div>
              <label className="block text-sm font-medium mb-1">Test Type</label>
              <select
                value={selectedTest}
                onChange={(e) => setSelectedTest(e.target.value)}
                className="w-full p-2 border rounded"
              >
                {Object.keys(labTemplates).map(test => (
                  <option key={test} value={test}>{test}</option>
                ))}
              </select>
            </div>
          </div>
          
          <div className="border-t pt-4">
            <h4 className="font-medium mb-3">Enter Results</h4>
            <div className="grid grid-cols-1 gap-3 max-h-96 overflow-y-auto">
              {Object.values(results).map((test) => (
                <div key={test.name} className="flex items-center gap-3 bg-gray-50 p-3 rounded">
                  <div className="flex-1">
                    <div className="font-medium text-sm">{test.name}</div>
                    <div className="text-xs text-gray-500">
                      Ref: {test.refMin} - {test.refMax} {test.unit}
                    </div>
                  </div>
                  <input
                    type="number"
                    step="0.01"
                    placeholder="Value"
                    value={test.value}
                    onChange={(e) => setResults({
                      ...results,
                      [test.name]: { ...test, value: parseFloat(e.target.value) || '' }
                    })}
                    className="w-24 p-2 border rounded"
                  />
                  <span className="text-sm text-gray-600 w-16">{test.unit}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
        <div className="flex gap-2 mt-4">
          <button onClick={handleSubmit} className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            Save
          </button>
          <button onClick={() => setShowForm(false)} className="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">
            Cancel
          </button>
        </div>
      </div>
    );
  };

  const Dashboard = () => {
    const currentLabs = labResults[selectedParent];
    const currentMeds = medications[selectedParent];
    const upcomingApts = appointments[selectedParent]
      .filter(apt => new Date(apt.date) >= new Date())
      .sort((a, b) => new Date(a.date) - new Date(b.date));

    // Get latest results summary
    const latestResults = currentLabs.length > 0 
      ? currentLabs.sort((a, b) => new Date(b.date) - new Date(a.date))[0]
      : null;

    // Get all abnormal values with details
    const abnormalValues = [];
    currentLabs.forEach(lab => {
      lab.results.forEach(result => {
        const converted = convertResult(result);
        if (converted.value < converted.refMin || converted.value > converted.refMax) {
          abnormalValues.push({
            date: lab.date,
            testType: lab.testType,
            name: converted.name,
            value: converted.value,
            unit: converted.unit,
            refMin: converted.refMin,
            refMax: converted.refMax,
            status: converted.value < converted.refMin ? 'Low' : 'High'
          });
        }
      });
    });

    // Count abnormal values
    const abnormalCount = abnormalValues.length;

    // Get kidney function indicators
    const kidneyTests = ['Creatinine', 'BUN', 'eGFR', 'BUN/Creatinine Ratio', 'Albumin/Creatinine Ratio', 'Uric Acid', 'Cystatin C'];
    const latestKidneyResults = [];
    kidneyTests.forEach(testName => {
      let latest = null;
      let latestDate = null;
      currentLabs.forEach(lab => {
        lab.results.forEach(result => {
          if (result.name === testName) {
            const labDate = new Date(lab.date);
            if (!latestDate || labDate > latestDate) {
              latestDate = labDate;
              latest = convertResult(result);
            }
          }
        });
      });
      if (latest) {
        latestKidneyResults.push(latest);
      }
    });

    // Calculate kidney health score (0-100, higher is better)
    let kidneyScore = 100;
    let kidneyIssues = [];
    latestKidneyResults.forEach(result => {
      if (result.value < result.refMin || result.value > result.refMax) {
        // Critical kidney markers
        if (result.name === 'eGFR' && result.value < 60) {
          kidneyScore -= 30;
          kidneyIssues.push(`Low eGFR (${result.value})`);
        } else if (result.name === 'Creatinine' && result.value > 1.5) {
          kidneyScore -= 20;
          kidneyIssues.push(`High Creatinine (${result.value})`);
        } else if (result.name === 'Albumin/Creatinine Ratio' && result.value > 30) {
          kidneyScore -= 15;
          kidneyIssues.push(`Elevated ACR (${result.value})`);
        } else {
          kidneyScore -= 10;
        }
      }
    });
    kidneyScore = Math.max(0, kidneyScore);
    const hasKidneyData = latestKidneyResults.length > 0;

    // Get key metrics for charting
    const getMetricData = (testName) => {
      return currentLabs
        .flatMap(lab => lab.results
          .filter(r => r.name === testName)
          .map(r => {
            const converted = convertResult(r);
            return {
              date: lab.date,
              value: converted.value,
              refMin: converted.refMin,
              refMax: converted.refMax,
              unit: converted.unit
            };
          })
        )
        .sort((a, b) => new Date(a.date) - new Date(b.date));
    };

    // Find common tests across all results
    const allTests = new Set();
    currentLabs.forEach(lab => {
      lab.results.forEach(r => allTests.add(r.name));
    });
    
    const commonTests = Array.from(allTests).filter(testName => {
      const data = getMetricData(testName);
      return data.length >= 2; // Only show tests with 2+ readings
    }).slice(0, 6); // Show max 6 charts

    return (
      <div className="space-y-6">
        {/* Summary Cards */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg">
            <div className="text-sm text-blue-600 font-medium">Total Lab Tests</div>
            <div className="text-3xl font-bold text-blue-900 mt-1">{currentLabs.length}</div>
            <div className="text-xs text-blue-600 mt-1">
              {latestResults && `Last: ${latestResults.date}`}
            </div>
          </div>

          <div className="bg-green-50 border-l-4 border-green-500 p-4 rounded-lg">
            <div className="text-sm text-green-600 font-medium">Active Medications</div>
            <div className="text-3xl font-bold text-green-900 mt-1">{currentMeds.length}</div>
            <div className="text-xs text-green-600 mt-1">Currently taking</div>
          </div>

          <div className="bg-purple-50 border-l-4 border-purple-500 p-4 rounded-lg">
            <div className="text-sm text-purple-600 font-medium">Upcoming Appointments</div>
            <div className="text-3xl font-bold text-purple-900 mt-1">{upcomingApts.length}</div>
            <div className="text-xs text-purple-600 mt-1">
              {upcomingApts[0] && `Next: ${new Date(upcomingApts[0].date).toLocaleDateString()}`}
            </div>
          </div>

          <div className={`border-l-4 p-4 rounded-lg ${
            abnormalCount > 0 
              ? 'bg-red-50 border-red-500' 
              : 'bg-green-50 border-green-500'
          }`}>
            <div className={`text-sm font-medium ${
              abnormalCount > 0 ? 'text-red-600' : 'text-green-600'
            }`}>
              Abnormal Values
            </div>
            <div className={`text-3xl font-bold mt-1 ${
              abnormalCount > 0 ? 'text-red-900' : 'text-green-900'
            }`}>
              {abnormalCount}
            </div>
            <div className={`text-xs mt-1 ${
              abnormalCount > 0 ? 'text-red-600' : 'text-green-600'
            }`}>
              {abnormalCount === 0 ? 'All normal' : 'Needs attention'}
            </div>
          </div>
        </div>

        {/* Kidney Health Indicator */}
        {hasKidneyData && (
          <div className={`p-6 rounded-lg shadow border-l-4 ${
            kidneyScore >= 80 ? 'bg-green-50 border-green-500' :
            kidneyScore >= 60 ? 'bg-yellow-50 border-yellow-500' :
            'bg-red-50 border-red-500'
          }`}>
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <div className="flex items-center gap-3 mb-3">
                  <Activity className={
                    kidneyScore >= 80 ? 'text-green-600' :
                    kidneyScore >= 60 ? 'text-yellow-600' :
                    'text-red-600'
                  } size={28} />
                  <div>
                    <h3 className="text-lg font-semibold text-gray-900">Kidney Function Status</h3>
                    <div className="text-sm text-gray-600">Based on {latestKidneyResults.length} kidney test{latestKidneyResults.length > 1 ? 's' : ''}</div>
                  </div>
                </div>
                
                <div className="mb-4">
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm font-medium text-gray-700">Health Score</span>
                    <span className={`text-2xl font-bold ${
                      kidneyScore >= 80 ? 'text-green-700' :
                      kidneyScore >= 60 ? 'text-yellow-700' :
                      'text-red-700'
                    }`}>
                      {kidneyScore}/100
                    </span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-3">
                    <div 
                      className={`h-3 rounded-full transition-all ${
                        kidneyScore >= 80 ? 'bg-green-500' :
                        kidneyScore >= 60 ? 'bg-yellow-500' :
                        'bg-red-500'
                      }`}
                      style={{ width: `${kidneyScore}%` }}
                    />
                  </div>
                </div>

                <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                  {latestKidneyResults.map((result, idx) => {
                    const isLow = result.value < result.refMin;
                    const isHigh = result.value > result.refMax;
                    const isNormal = !isLow && !isHigh;
                    
                    return (
                      <div key={idx} className={`p-3 rounded border ${
                        isNormal ? 'bg-white border-green-300' :
                        isLow ? 'bg-blue-50 border-blue-300' :
                        'bg-red-50 border-red-300'
                      }`}>
                        <div className="text-xs font-medium text-gray-700">{result.name}</div>
                        <div className={`text-lg font-bold ${
                          isNormal ? 'text-green-700' :
                          isLow ? 'text-blue-700' :
                          'text-red-700'
                        }`}>
                          {result.value}
                        </div>
                        <div className="text-xs text-gray-600">{result.unit}</div>
                      </div>
                    );
                  })}
                </div>

                {kidneyIssues.length > 0 && (
                  <div className="mt-4 p-3 bg-white rounded border border-orange-300">
                    <div className="flex items-start gap-2">
                      <AlertCircle className="text-orange-600 mt-0.5" size={16} />
                      <div>
                        <div className="font-semibold text-orange-900 text-sm">Areas of Concern:</div>
                        <ul className="text-sm text-orange-800 mt-1 space-y-1">
                          {kidneyIssues.map((issue, idx) => (
                            <li key={idx}>‚Ä¢ {issue}</li>
                          ))}
                        </ul>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        )}

        {/* Abnormal Values Alert Section */}
        {abnormalValues.length > 0 && (
          <div className="bg-red-50 border-l-4 border-red-500 p-6 rounded-lg shadow">
            <div className="flex items-center gap-2 mb-4">
              <AlertTriangle className="text-red-600" size={24} />
              <h3 className="text-lg font-semibold text-red-900">
                {abnormalValues.length} Value{abnormalValues.length > 1 ? 's' : ''} Out of Range
              </h3>
            </div>
            <div className="space-y-2">
              {abnormalValues.slice(0, 10).map((item, idx) => (
                <div key={idx} className="bg-white p-3 rounded flex items-center justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-2">
                      <span className="font-semibold text-gray-900">{item.name}</span>
                      <span className={`text-xs px-2 py-1 rounded font-medium ${
                        item.status === 'Low' 
                          ? 'bg-blue-100 text-blue-700' 
                          : 'bg-red-100 text-red-700'
                      }`}>
                        {item.status}
                      </span>
                    </div>
                    <div className="text-sm text-gray-600 mt-1">
                      Value: <span className="font-medium">{item.value} {item.unit}</span> | 
                      Normal: {item.refMin}-{item.refMax} {item.unit}
                    </div>
                    <div className="text-xs text-gray-500">{item.testType} ‚Ä¢ {item.date}</div>
                  </div>
                  <AlertCircle className={item.status === 'Low' ? 'text-blue-500' : 'text-red-500'} size={20} />
                </div>
              ))}
              {abnormalValues.length > 10 && (
                <div className="text-sm text-gray-600 text-center pt-2">
                  Showing 10 of {abnormalValues.length} abnormal values
                </div>
              )}
            </div>
          </div>
        )}

        {/* Latest Results */}
        {latestResults && (
          <div className="bg-white p-6 rounded-lg shadow">
            <h3 className="text-lg font-semibold mb-4">Latest Test Results - {latestResults.testType}</h3>
            <div className="text-sm text-gray-600 mb-4">Date: {latestResults.date}</div>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
              {latestResults.results.slice(0, 8).map((result, idx) => {
                const converted = convertResult(result);
                const isLow = converted.value < converted.refMin;
                const isHigh = converted.value > converted.refMax;
                const isNormal = !isLow && !isHigh;
                
                return (
                  <div key={idx} className={`p-3 rounded-lg border-2 shadow-sm ${
                    isNormal ? 'bg-green-50 border-green-400' : 
                    isLow ? 'bg-blue-50 border-blue-400' : 
                    'bg-red-50 border-red-400'
                  }`}>
                    <div className="flex justify-between items-start mb-1">
                      <div className="font-medium text-sm text-gray-900">{converted.name}</div>
                      {isNormal ? (
                        <CheckCircle className="text-green-600" size={16} />
                      ) : (
                        <AlertCircle className={isLow ? 'text-blue-600' : 'text-red-600'} size={16} />
                      )}
                    </div>
                    <div className="text-2xl font-bold text-gray-900 mb-1">
                      {converted.value}
                    </div>
                    <div className="text-xs text-gray-700 font-medium mb-1">{converted.unit}</div>
                    <div className={`text-xs font-medium px-2 py-1 rounded ${
                      isNormal ? 'bg-green-100 text-green-800' : 
                      isLow ? 'bg-blue-100 text-blue-800' : 
                      'bg-red-100 text-red-800'
                    }`}>
                      {isNormal ? '‚úì Normal' : isLow ? '‚Üì Below Range' : '‚Üë Above Range'}
                    </div>
                    <div className="text-xs text-gray-600 mt-2 border-t border-gray-300 pt-2">
                      Normal: {converted.refMin}-{converted.refMax}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        )}

        {/* Trend Charts */}
        {commonTests.length > 0 ? (
          <div className="bg-white p-6 rounded-lg shadow">
            <h3 className="text-lg font-semibold mb-4">Key Metrics Trends</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              {commonTests.map(testName => {
                const data = getMetricData(testName);
                if (data.length === 0) return null;

                const refMin = data[0].refMin;
                const refMax = data[0].refMax;
                const unit = data[0].unit;
                const latestValue = data[data.length - 1].value;
                const isAbnormal = latestValue < refMin || latestValue > refMax;
                const isLow = latestValue < refMin;
                
                // Check if custom range is being used
                const rangeKey = `${testName}-${unit}`;
                const hasCustomRange = !!customRanges[rangeKey];

                return (
                  <div key={testName} className={`border-2 rounded-lg p-4 ${
                    isAbnormal 
                      ? isLow ? 'border-blue-400 bg-blue-50' : 'border-red-400 bg-red-50'
                      : 'border-gray-200'
                  }`}>
                    <div className="flex justify-between items-center mb-2">
                      <h4 className="font-semibold">{testName}</h4>
                      {isAbnormal ? (
                        <div className="flex items-center gap-2">
                          <AlertTriangle className={isLow ? 'text-blue-600' : 'text-red-600'} size={18} />
                          <span className={`text-xs px-2 py-1 rounded font-medium ${
                            isLow ? 'bg-blue-100 text-blue-800' : 'bg-red-100 text-red-800'
                          }`}>
                            {isLow ? '‚Üì Below Range' : '‚Üë Above Range'}
                          </span>
                        </div>
                      ) : (
                        <div className="flex items-center gap-1">
                          <CheckCircle className="text-green-600" size={18} />
                          <span className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded font-medium">
                            ‚úì Normal
                          </span>
                        </div>
                      )}
                    </div>
                    <ResponsiveContainer width="100%" height={200}>
                      <LineChart data={data}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="date" tick={{ fontSize: 12 }} />
                        <YAxis tick={{ fontSize: 12 }} />
                        <Tooltip />
                        <ReferenceLine y={refMin} stroke="orange" strokeDasharray="3 3" />
                        <ReferenceLine y={refMax} stroke="orange" strokeDasharray="3 3" />
                        <Line type="monotone" dataKey="value" stroke="#2563eb" strokeWidth={2} dot={{ r: 4 }} />
                      </LineChart>
                    </ResponsiveContainer>
                    <div className="text-xs text-gray-600 mt-2">
                      Normal: {refMin} - {refMax} {unit} | Latest: {latestValue} {unit}
                      {hasCustomRange && (
                        <span className="text-teal-600 font-medium ml-2">‚òÖ Custom</span>
                      )}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        ) : (
          <div className="bg-white p-6 rounded-lg shadow text-center text-gray-500">
            <p>Add at least 2 lab results to see trend charts</p>
          </div>
        )}

        {/* Upcoming Appointments */}
        {upcomingApts.length > 0 && (
          <div className="bg-white p-6 rounded-lg shadow">
            <h3 className="text-lg font-semibold mb-4">Upcoming Appointments</h3>
            <div className="space-y-3">
              {upcomingApts.slice(0, 3).map(apt => (
                <div key={apt.id} className="flex items-start gap-4 p-3 bg-gray-50 rounded">
                  <Calendar className="text-purple-600 mt-1" size={20} />
                  <div className="flex-1">
                    <div className="font-semibold">{apt.type}</div>
                    <div className="text-sm text-gray-600">{apt.doctor}</div>
                    <div className="text-sm text-gray-500">{new Date(apt.date).toLocaleString()}</div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Active Medications */}
        {currentMeds.length > 0 && (
          <div className="bg-white p-6 rounded-lg shadow">
            <h3 className="text-lg font-semibold mb-4">Active Medications</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
              {currentMeds.map(med => (
                <div key={med.id} className="flex items-start gap-3 p-3 bg-gray-50 rounded">
                  <Pill className="text-green-600 mt-1" size={20} />
                  <div className="flex-1">
                    <div className="font-semibold">{med.name}</div>
                    <div className="text-sm text-gray-600">{med.dosage} - {med.frequency}</div>
                    <div className="text-xs text-gray-500">Take at {med.time}</div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    );
  };

  const TrendChart = ({ testName }) => {
    const data = labResults[selectedParent]
      .flatMap(lab => lab.results
        .filter(r => r.name === testName)
        .map(r => {
          const converted = convertResult(r);
          return {
            date: lab.date,
            value: converted.value,
            refMin: converted.refMin,
            refMax: converted.refMax,
            unit: converted.unit
          };
        })
      )
      .sort((a, b) => new Date(a.date) - new Date(b.date));

    if (data.length === 0) return <div className="text-gray-500 text-center py-8">No data available</div>;

    const refMin = data[0].refMin;
    const refMax = data[0].refMax;
    const unit = data[0].unit;
    
    // Check if custom range is being used
    const rangeKey = `${testName}-${unit}`;
    const hasCustomRange = !!customRanges[rangeKey];
    
    // Check if any values are out of range
    const abnormalReadings = data.filter(d => d.value < refMin || d.value > refMax);
    const hasAbnormal = abnormalReadings.length > 0;

    return (
      <div className={`p-6 rounded-lg shadow-md mb-4 border-2 ${
        hasAbnormal ? 'bg-red-50 border-red-400' : 'bg-white border-gray-200'
      }`}>
        <div className="flex justify-between items-center mb-4">
          <div>
            <h3 className="text-lg font-semibold">{testName} Trend</h3>
            <div className="text-sm text-gray-600 mt-1">
              {data.length} reading{data.length > 1 ? 's' : ''} from {data[0].date} to {data[data.length - 1].date}
            </div>
          </div>
          <button onClick={() => setShowChart(null)} className="text-gray-500 hover:text-gray-700">
            <X size={24} />
          </button>
        </div>
        
        {hasAbnormal && (
          <div className="bg-red-100 border border-red-400 rounded p-3 mb-4 flex items-start gap-2">
            <AlertTriangle className="text-red-600 mt-0.5" size={20} />
            <div>
              <div className="font-semibold text-red-900">
                {abnormalReadings.length} out of {data.length} reading{abnormalReadings.length > 1 ? 's are' : ' is'} out of range
              </div>
              <div className="text-sm text-red-800 mt-1">
                Normal range: {refMin} - {refMax} {unit}
              </div>
            </div>
          </div>
        )}
        
        <ResponsiveContainer width="100%" height={300}>
          <LineChart data={data}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="date" />
            <YAxis />
            <Tooltip 
              formatter={(value) => [`${value} ${unit}`, 'Value']}
              labelFormatter={(label) => `Date: ${label}`}
            />
            <Legend />
            <ReferenceLine 
              y={refMin} 
              stroke="#f97316" 
              strokeDasharray="5 5" 
              label={{ value: `Min: ${refMin}`, position: 'left', fill: '#f97316' }}
              strokeWidth={2}
            />
            <ReferenceLine 
              y={refMax} 
              stroke="#f97316" 
              strokeDasharray="5 5" 
              label={{ value: `Max: ${refMax}`, position: 'left', fill: '#f97316' }}
              strokeWidth={2}
            />
            <Line 
              type="monotone" 
              dataKey="value" 
              stroke="#2563eb" 
              strokeWidth={3} 
              dot={{ r: 6, fill: '#2563eb' }}
              activeDot={{ r: 8 }}
            />
          </LineChart>
        </ResponsiveContainer>
        
        <div className="mt-4 p-3 bg-gray-50 rounded border border-gray-200">
          <div className="grid grid-cols-2 gap-4">
            <div>
              <div className="text-xs text-gray-600 font-medium">Reference Range</div>
              <div className="text-lg font-semibold text-gray-900">
                {refMin} - {refMax} {unit}
              </div>
              {hasCustomRange && (
                <div className="text-xs text-teal-600 font-medium mt-1">‚òÖ Custom range active</div>
              )}
            </div>
            <div>
              <div className="text-xs text-gray-600 font-medium">Latest Value</div>
              <div className={`text-lg font-semibold ${
                data[data.length - 1].value < refMin || data[data.length - 1].value > refMax
                  ? 'text-red-600'
                  : 'text-green-600'
              }`}>
                {data[data.length - 1].value} {unit}
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  };

  const MedicationForm = () => {
    const [formData, setFormData] = useState({
      name: '',
      dosage: '',
      frequency: 'Once daily',
      time: '08:00'
    });

    const handleSubmit = () => {
      if (formData.name && formData.dosage) {
        addMedication(formData);
        setShowForm(false);
      }
    };

    return (
      <div className="bg-white p-6 rounded-lg shadow-md mb-4">
        <h3 className="text-lg font-semibold mb-4">Add Medication</h3>
        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium mb-1">Medication Name</label>
            <input
              type="text"
              value={formData.name}
              onChange={(e) => setFormData({...formData, name: e.target.value})}
              className="w-full p-2 border rounded"
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Dosage</label>
            <input
              type="text"
              value={formData.dosage}
              onChange={(e) => setFormData({...formData, dosage: e.target.value})}
              className="w-full p-2 border rounded"
              placeholder="e.g., 10mg"
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Frequency</label>
            <select
              value={formData.frequency}
              onChange={(e) => setFormData({...formData, frequency: e.target.value})}
              className="w-full p-2 border rounded"
            >
              <option>Once daily</option>
              <option>Twice daily</option>
              <option>Three times daily</option>
              <option>As needed</option>
              <option>Weekly</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Time</label>
            <input
              type="time"
              value={formData.time}
              onChange={(e) => setFormData({...formData, time: e.target.value})}
              className="w-full p-2 border rounded"
            />
          </div>
        </div>
        <div className="flex gap-2 mt-4">
          <button onClick={handleSubmit} className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            Save
          </button>
          <button onClick={() => setShowForm(false)} className="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">
            Cancel
          </button>
        </div>
      </div>
    );
  };

  const AppointmentForm = () => {
    const [formData, setFormData] = useState({
      date: '',
      doctor: '',
      type: '',
      notes: ''
    });

    const handleSubmit = () => {
      if (formData.date && formData.doctor && formData.type) {
        addAppointment(formData);
        setShowForm(false);
      }
    };

    return (
      <div className="bg-white p-6 rounded-lg shadow-md mb-4">
        <h3 className="text-lg font-semibold mb-4">Add Appointment</h3>
        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium mb-1">Date & Time</label>
            <input
              type="datetime-local"
              value={formData.date}
              onChange={(e) => setFormData({...formData, date: e.target.value})}
              className="w-full p-2 border rounded"
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Doctor</label>
            <input
              type="text"
              value={formData.doctor}
              onChange={(e) => setFormData({...formData, doctor: e.target.value})}
              className="w-full p-2 border rounded"
            />
          </div>
          <div className="col-span-2">
            <label className="block text-sm font-medium mb-1">Appointment Type</label>
            <input
              type="text"
              value={formData.type}
              onChange={(e) => setFormData({...formData, type: e.target.value})}
              className="w-full p-2 border rounded"
              placeholder="e.g., Cardiology, General Checkup"
            />
          </div>
          <div className="col-span-2">
            <label className="block text-sm font-medium mb-1">Notes</label>
            <textarea
              value={formData.notes}
              onChange={(e) => setFormData({...formData, notes: e.target.value})}
              className="w-full p-2 border rounded"
              rows="3"
            />
          </div>
        </div>
        <div className="flex gap-2 mt-4">
          <button onClick={handleSubmit} className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            Save
          </button>
          <button onClick={() => setShowForm(false)} className="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">
            Cancel
          </button>
        </div>
      </div>
    );
  };

  const NoteForm = () => {
    const [formData, setFormData] = useState({
      title: '',
      content: '',
      category: 'General'
    });

    const handleSubmit = () => {
      if (formData.title && formData.content) {
        addNote(formData);
        setShowForm(false);
      }
    };

    return (
      <div className="bg-white p-6 rounded-lg shadow-md mb-4">
        <h3 className="text-lg font-semibold mb-4">Add Note</h3>
        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium mb-1">Title</label>
            <input
              type="text"
              value={formData.title}
              onChange={(e) => setFormData({...formData, title: e.target.value})}
              className="w-full p-2 border rounded"
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Category</label>
            <select
              value={formData.category}
              onChange={(e) => setFormData({...formData, category: e.target.value})}
              className="w-full p-2 border rounded"
            >
              <option>General</option>
              <option>Symptoms</option>
              <option>Diet</option>
              <option>Exercise</option>
              <option>Concerns</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Content</label>
            <textarea
              value={formData.content}
              onChange={(e) => setFormData({...formData, content: e.target.value})}
              className="w-full p-2 border rounded"
              rows="4"
            />
          </div>
        </div>
        <div className="flex gap-2 mt-4">
          <button onClick={handleSubmit} className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            Save
          </button>
          <button onClick={() => setShowForm(false)} className="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">
            Cancel
          </button>
        </div>
      </div>
    );
  };

  const renderContent = () => {
    if (showSettings) {
      return <SettingsPanel />;
    }

    if (showChart) {
      return <TrendChart testName={showChart} />;
    }

    if (showForm) {
      switch(activeTab) {
        case 'labs':
          return <LabResultForm />;
        case 'medications':
          return <MedicationForm />;
        case 'appointments':
          return <AppointmentForm />;
        case 'notes':
          return <NoteForm />;
        default:
          return null;
      }
    }

    switch(activeTab) {
      case 'dashboard':
        return <Dashboard />;
      
      case 'labs':
        return (
          <div className="space-y-4">
            {labResults[selectedParent].sort((a, b) => new Date(b.date) - new Date(a.date)).map(lab => (
              <div key={lab.id} className="bg-white p-4 rounded-lg shadow">
                <div className="flex justify-between items-start mb-3">
                  <div>
                    <div className="font-semibold text-lg">{lab.testType}</div>
                    <div className="text-sm text-gray-500">{lab.date}</div>
                  </div>
                  <button 
                    onClick={() => deleteItem(lab.id, 'labs')}
                    className="text-red-500 hover:text-red-700 text-2xl"
                  >
                    √ó
                  </button>
                </div>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                  {lab.results.map((result, idx) => {
                    const converted = convertResult(result);
                    const isLow = converted.value < converted.refMin;
                    const isHigh = converted.value > converted.refMax;
                    const isNormal = !isLow && !isHigh;
                    
                    return (
                      <div key={idx} className={`p-3 rounded-lg border-2 shadow-sm ${
                        isNormal ? 'bg-green-50 border-green-400' : 
                        isLow ? 'bg-blue-50 border-blue-400' : 
                        'bg-red-50 border-red-400'
                      }`}>
                        <div className="flex justify-between items-start">
                          <div className="flex-1">
                            <div className="flex items-center gap-2 mb-1">
                              <div className="font-medium text-sm text-gray-900">{converted.name}</div>
                              {isNormal ? (
                                <CheckCircle className="text-green-600" size={14} />
                              ) : (
                                <AlertCircle className={isLow ? 'text-blue-600' : 'text-red-600'} size={14} />
                              )}
                            </div>
                            <div className="text-xl font-bold text-gray-900">
                              {converted.value}
                            </div>
                            <div className="text-xs text-gray-700 font-medium">{converted.unit}</div>
                            <div className={`text-xs font-medium px-2 py-1 rounded mt-2 inline-block ${
                              isNormal ? 'bg-green-100 text-green-800' : 
                              isLow ? 'bg-blue-100 text-blue-800' : 
                              'bg-red-100 text-red-800'
                            }`}>
                              {isNormal ? '‚úì Normal' : isLow ? '‚Üì Low' : '‚Üë High'}
                            </div>
                            <div className="text-xs text-gray-600 mt-2 pt-2 border-t border-gray-300">
                              <div className="font-medium">Normal Range:</div>
                              <div>{converted.refMin} - {converted.refMax} {converted.unit}</div>
                              {converted.hasCustomRange && (
                                <div className="text-teal-600 font-medium mt-1">‚òÖ Custom range</div>
                              )}
                            </div>
                          </div>
                          <button
                            onClick={() => setShowChart(result.name)}
                            className="text-blue-600 hover:text-blue-800 ml-2"
                            title="View trend"
                          >
                            <TrendingUp size={16} />
                          </button>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            ))}
            {labResults[selectedParent].length === 0 && (
              <div className="text-center text-gray-500 py-8">No lab results yet</div>
            )}
          </div>
        );
      
      case 'medications':
        return (
          <div className="space-y-3">
            {medications[selectedParent].map(med => (
              <div key={med.id} className="bg-white p-4 rounded-lg shadow">
                <div className="flex justify-between items-start">
                  <div>
                    <div className="font-semibold text-lg">{med.name}</div>
                    <div className="text-gray-700">{med.dosage} - {med.frequency}</div>
                    <div className="text-sm text-gray-500 mt-1">Take at {med.time}</div>
                  </div>
                  <button 
                    onClick={() => deleteItem(med.id, 'medications')}
                    className="text-red-500 hover:text-red-700 text-2xl"
                  >
                    √ó
                  </button>
                </div>
              </div>
            ))}
            {medications[selectedParent].length === 0 && (
              <div className="text-center text-gray-500 py-8">No medications added yet</div>
            )}
          </div>
        );
      
      case 'appointments':
        return (
          <div className="space-y-3">
            {appointments[selectedParent].map(apt => (
              <div key={apt.id} className="bg-white p-4 rounded-lg shadow">
                <div className="flex justify-between items-start">
                  <div>
                    <div className="font-semibold text-lg">{apt.type}</div>
                    <div className="text-gray-700">with {apt.doctor}</div>
                    <div className="text-sm text-gray-500 mt-1">{apt.date}</div>
                    {apt.notes && <div className="text-sm text-gray-600 mt-2">{apt.notes}</div>}
                  </div>
                  <button 
                    onClick={() => deleteItem(apt.id, 'appointments')}
                    className="text-red-500 hover:text-red-700 text-2xl"
                  >
                    √ó
                  </button>
                </div>
              </div>
            ))}
            {appointments[selectedParent].length === 0 && (
              <div className="text-center text-gray-500 py-8">No appointments scheduled</div>
            )}
          </div>
        );
      
      case 'notes':
        return (
          <div className="space-y-3">
            {notes[selectedParent].map(note => (
              <div key={note.id} className="bg-white p-4 rounded-lg shadow">
                <div className="flex justify-between items-start">
                  <div className="flex-1">
                    <div className="flex items-center gap-2">
                      <div className="font-semibold text-lg">{note.title}</div>
                      <span className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">
                        {note.category}
                      </span>
                    </div>
                    <div className="text-gray-700 mt-2">{note.content}</div>
                    <div className="text-sm text-gray-500 mt-2">
                      {new Date(note.timestamp).toLocaleString()}
                    </div>
                  </div>
                  <button 
                    onClick={() => deleteItem(note.id, 'notes')}
                    className="text-red-500 hover:text-red-700 text-2xl"
                  >
                    √ó
                  </button>
                </div>
              </div>
            ))}
            {notes[selectedParent].length === 0 && (
              <div className="text-center text-gray-500 py-8">No notes added yet</div>
            )}
          </div>
        );
      
      default:
        return null;
    }
  };

  if (isLoading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-gray-600">Loading...</div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 p-6">
      {showShareDialog && <ShareDialog />}
      
      <div className="max-w-6xl mx-auto">
        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
          <div className="flex justify-between items-center">
            <div>
              <h1 className="text-3xl font-bold text-gray-800 mb-2">{t('appTitle')}</h1>
              <p className="text-gray-600">{t('appSubtitle')}</p>
            </div>
            <div className="flex gap-2">
              <button
                onClick={toggleSharing}
                className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium ${
                  sharingEnabled 
                    ? 'bg-green-600 text-white hover:bg-green-700' 
                    : 'bg-orange-600 text-white hover:bg-orange-700'
                }`}
              >
                <Share2 size={20} />
                {sharingEnabled ? t('sharingEnabled') : t('enableSharing')}
              </button>
              <button
                onClick={() => setShowSettings(!showSettings)}
                className="flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700"
              >
                <Settings size={20} />
                {t('customize')}
              </button>
              <button
                onClick={exportToCSV}
                className="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
              >
                <Download size={20} />
                {t('export')}
              </button>
            </div>
          </div>
          
          {sharingEnabled && (
            <div className="mt-4 p-3 bg-green-50 border border-green-200 rounded flex items-center justify-between">
              <div className="flex items-center gap-2">
                <Check className="text-green-600" size={20} />
                <span className="text-sm text-green-800 font-medium">
                  Sharing is active - your caregiver can access this dashboard
                </span>
              </div>
              <button
                onClick={() => setShowShareDialog(true)}
                className="text-sm text-green-700 hover:text-green-900 underline"
              >
                View share link
              </button>
            </div>
          )}
        </div>

        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
          <div className="flex gap-4">
            <button
              onClick={() => { setSelectedParent('mom'); setShowForm(false); setShowChart(null); }}
              className={`flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ${
                selectedParent === 'mom' 
                  ? 'bg-pink-600 text-white' 
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              <User size={20} />
              {t('mom')}
            </button>
            <button
              onClick={() => { setSelectedParent('dad'); setShowForm(false); setShowChart(null); }}
              className={`flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ${
                selectedParent === 'dad' 
                  ? 'bg-blue-600 text-white' 
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              <User size={20} />
              {t('dad')}
            </button>
          </div>
        </div>

        <div className="bg-white rounded-lg shadow-lg p-6">
          <div className="flex gap-2 mb-6 overflow-x-auto">
            <button
              onClick={() => { setActiveTab('dashboard'); setShowForm(false); setShowChart(null); setShowSettings(false); }}
              className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${
                activeTab === 'dashboard' 
                  ? 'bg-blue-600 text-white' 
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              <TrendingUp size={20} />
              {t('dashboard')}
            </button>
            <button
              onClick={() => { setActiveTab('labs'); setShowForm(false); setShowChart(null); setShowSettings(false); }}
              className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${
                activeTab === 'labs' 
                  ? 'bg-blue-600 text-white' 
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              <Activity size={20} />
              {t('labResults')}
            </button>
            <button
              onClick={() => { setActiveTab('medications'); setShowForm(false); setShowChart(null); setShowSettings(false); }}
              className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${
                activeTab === 'medications' 
                  ? 'bg-blue-600 text-white' 
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              <Pill size={20} />
              {t('medications')}
            </button>
            <button
              onClick={() => { setActiveTab('appointments'); setShowForm(false); setShowChart(null); setShowSettings(false); }}
              className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${
                activeTab === 'appointments' 
                  ? 'bg-blue-600 text-white' 
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              <Calendar size={20} />
              {t('appointments')}
            </button>
            <button
              onClick={() => { setActiveTab('notes'); setShowForm(false); setShowChart(null); setShowSettings(false); }}
              className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${
                activeTab === 'notes' 
                  ? 'bg-blue-600 text-white' 
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              <FileText size={20} />
              {t('notes')}
            </button>
          </div>

          {!showForm && !showChart && !showSettings && activeTab !== 'dashboard' && (
            <button
              onClick={() => setShowForm(true)}
              className="mb-6 flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
            >
              <Plus size={20} />
              {t('addNew')}
            </button>
          )}

          {renderContent()}
        </div>
      </div>
    </div>
  );
};

export default LabTracker;
